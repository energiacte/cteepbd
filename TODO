# TODO

- maybe bug: see why emissions for ACS for the manual's example change
  depending on whether nearby factors are used or not.

- epbd:
  - Compute ratio of prod_onst / used
    - prod_onst_by_srv?
      - En cada paso se calcula el total EPB consumido de cada vector
      - Se reparte la producción del vector con el uso total EPB según el f_match del vector (y prioridades)
      - Ver balance.rs:224 y EN 52000-1 9.6.6.2.4
    - used_by_srv
  - define COGEN as a new (neither EPB nor EPB) service for energy used for cogeneration (see Module M11 in EN 15316)
    - how does it relate to EPB and NEPB services? (where is it accounted for? review filtering in code)?
    - compute cogen electricity factors from used energy for COGEN service
    - EUsed to attribute carrier use to electricity cogeneration. Check impact in all other computations (could be used to find cogeneration factors).
    - Describe default method to find used energy from electrical efficiency of cogeneration.
    - Activate J4_cogen_fuel_boiler test
  - Datos de ZONA completar con EN 52000-1, 12.1 informe
  - Datos de SISTEMA
    - Eficiencias de sistemas (no las calculamos sino que son datos)
    - Ver para qué sistemas (cal, ref, acs, ven?, ??)
    - Indicar qué tipo de sistema es
    - id, SISTEMA, GEN, COP, 2.95, EER, 3.2, COP_dhw, 3.1, SCOP, 3.2, SEER, 3.4, SCOP_dhw, 3.5, SPF_h, 2.95, SPF_c, 3.0, SPF_dhw, 3.4 # Nombre
    - id, SISTEMA, NGEN (DIS + EM), ???
  - Implement
    - battery support (in compute_used_produced)
    - priority in use of produced energy (onsite > cogen, for instance) (in compute_used_produced, compute_exported_delivered, 9.6.6.2.4)
  - checks: Q_out (SALIDA) services include, at least, those included in E_in (CONSUMO). Think about interactive building of components and transient states

- tests:

  - cte: check non matching computation modes in component metadata and weighting factors metadata

- input / output:
  - Test XML output and fix XML indentation
  - JSON input
  - Additional JSON output generated from the zone (ZONA) and system (SISTEMA) data
    - Energy needs (with annual totals)
    - System efficiencies / indicators
      - See UNE_EN 15316-1 formula (35). Varies by subsystem type
      - ¿Whole building efficiencies by service (non renewable primary energy)?
    - Fraction of energy use covered by renewable sources, by service and by system (id)
      - Calcular % de cobertura renovable (consumo EF) para los distintos servicios
    - Consumos de sistemas ficticios (id<=0?) y reales (id>0)
    - Calcular ReduccionEPNR y ReduccionEmisiones por uso de renovables
    - Demanda por servicios y total (¿y demanda de referencia si la hay?)
    - Valores totales de los distintos indicadores (Ver BalanceEPB nuevo y ver 52000-1 Tabla 5 para datos por servicio)
    - Cambiar RenNrenCo2 para tener algún factor más (tot y ren_nrb) -> (ren, nren, tot, co2)
    - Emisiones: desglose eléctrico y no eléctrico

## Wishlist

- use templates for output (plain, detailed, ...) depending on cli parameter
